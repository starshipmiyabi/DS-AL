<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>排序动态教学演示（插入/冒泡）</title>
    <style>
      :root {
        --bg: #0b1220;
        --panel: #111b2f;
        --text: #e7eefc;
        --muted: #9fb0d0;
        --line: #1f3157;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          "PingFang SC", "Microsoft YaHei";
        background: var(--bg);
        color: var(--text);
      }
      header {
        padding: 16px 18px;
        border-bottom: 1px solid var(--line);
      }
      header h1 {
        margin: 0 0 6px;
        font-size: 18px;
      }
      header p {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.5;
      }

      .wrap {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 12px;
        padding: 12px;
        max-width: 1100px;
        margin: 0 auto;
      }
      .card {
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 12px;
      }
      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }
      label {
        font-size: 13px;
        color: var(--muted);
      }
      select,
      input[type="text"],
      input[type="range"] {
        background: #0c1528;
        border: 1px solid var(--line);
        color: var(--text);
        border-radius: 10px;
        padding: 8px 10px;
        outline: none;
      }
      input[type="text"] {
        width: 100%;
      }
      button {
        background: #0c1528;
        border: 1px solid var(--line);
        color: var(--text);
        border-radius: 12px;
        padding: 8px 10px;
        cursor: pointer;
      }
      button:hover {
        border-color: #2e4c86;
      }
      button.primary {
        background: #17335f;
      }
      button.danger {
        background: #3a1220;
      }
      .spacer {
        flex: 1;
      }

      /* Visual */
      .viz {
        height: 340px;
        display: flex;
        align-items: flex-end;
        gap: 8px;
        padding: 10px;
        border-radius: 12px;
        background: #0c1528;
        border: 1px dashed #2a3f70;
      }
      .bar {
        width: 26px;
        min-width: 20px;
        border-radius: 10px 10px 6px 6px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: flex-end;
        justify-content: center;
        position: relative;
        transition: transform 0.15s ease, filter 0.15s ease;
      }
      .bar span {
        position: absolute;
        bottom: -22px;
        font-size: 12px;
        color: var(--muted);
      }
      .tag {
        position: absolute;
        top: -22px;
        font-size: 11px;
        color: #d5e6ff;
        padding: 2px 6px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(12, 21, 40, 0.9);
        white-space: nowrap;
      }
      .bar.highlight {
        filter: brightness(1.25);
        transform: translateY(-3px);
      }
      .bar.sorted {
        outline: 2px solid rgba(164, 236, 255, 0.55);
      }
      .legend {
        color: var(--muted);
        font-size: 12px;
        line-height: 1.6;
        margin-top: 8px;
      }
      .legend b {
        color: var(--text);
      }

      /* Right panel */
      .mono {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", monospace;
        font-size: 12px;
      }
      pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-word;
      }
      .status {
        padding: 10px;
        background: #0c1528;
        border: 1px solid var(--line);
        border-radius: 12px;
      }
      .status h3 {
        margin: 0 0 8px;
        font-size: 14px;
      }
      .status p {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.6;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: #0c1528;
        color: var(--muted);
        font-size: 12px;
      }
      .small {
        font-size: 12px;
        color: var(--muted);
      }
    </style>
  </head>

  <body>
    <header>
      <h1>排序动态教学演示（插入排序 / 冒泡排序）</h1>
      <p>
        课件要点：排序把“无序序列”调整为“有序序列”；内部排序的过程可以理解为：每一趟都在扩大“有序区”。（页面会用高亮
        + 有序框来演示这一点）
      </p>
    </header>

    <div class="wrap">
      <!-- Left: Visual + controls -->
      <section class="card">
        <div class="row" style="margin-bottom: 10px">
          <div class="row" style="gap: 8px">
            <label>算法</label>
            <select id="algo">
              <option value="insertion">直接插入排序</option>
              <option value="bubble">冒泡排序</option>
            </select>
          </div>

          <div class="row" style="gap: 8px">
            <label>速度</label>
            <input id="speed" type="range" min="60" max="900" value="260" />
            <span class="pill"
              ><span>每步</span><b id="speedText">260ms</b></span
            >
          </div>

          <div class="spacer"></div>

          <button id="random" class="primary">随机数据</button>
          <button id="apply">应用输入</button>
          <button id="reset" class="danger">重置步骤</button>
        </div>

        <label>输入数组（逗号分隔，例如：52,49,80,36,14,58）</label>
        <input id="arrInput" type="text" />

        <div class="row" style="margin: 10px 0">
          <button id="prev">◀ 上一步</button>
          <button id="next" class="primary">下一步 ▶</button>
          <button id="play" class="primary">⏵ 播放</button>

          <span class="pill"
            >步骤：<b id="stepIdx">0</b>/<b id="stepTotal">0</b></span
          >
          <span class="pill">状态：<b id="stateText">未开始</b></span>
        </div>

        <div id="viz" class="viz" aria-label="排序可视化区域"></div>

        <div class="legend">
          <div>提示：</div>
          <div>• <b>亮起的柱子</b>：当前比较/移动的元素</div>
          <div>
            • <b>描边的柱子</b>：当前“有序区”（插入：左侧扩大；冒泡：右侧扩大）
          </div>
        </div>
      </section>

      <!-- Right: Explanation + Pseudocode -->
      <aside class="card">
        <div class="status" style="margin-bottom: 10px">
          <h3>本步讲解</h3>
          <p id="msg">点击“下一步”开始。</p>
          <div class="small" style="margin-top: 8px">
            <span class="pill">i=<b id="iVal">-</b></span>
            <span class="pill">j=<b id="jVal">-</b></span>
            <span class="pill">有序区=<b id="sortedZone">-</b></span>
          </div>
        </div>

        <div class="status">
          <h3>对应伪代码（便于讲课）</h3>
          <pre id="code" class="mono"></pre>
        </div>
      </aside>
    </div>

    <script>
      // ---------- Utilities ----------
      const $ = (id) => document.getElementById(id);

      function clampInt(x, lo, hi) {
        const v = Number.parseInt(x, 10);
        if (Number.isNaN(v)) return lo;
        return Math.max(lo, Math.min(hi, v));
      }

      function parseArray(text) {
        const parts = text
          .split(",")
          .map((s) => s.trim())
          .filter(Boolean);
        const arr = parts.map((x) => Number(x));
        if (arr.length === 0 || arr.some((n) => Number.isNaN(n))) return null;
        return arr;
      }

      function randomArray(n = 10, lo = 5, hi = 99) {
        const a = [];
        for (let i = 0; i < n; i++)
          a.push(Math.floor(lo + Math.random() * (hi - lo + 1)));
        return a;
      }

      // ---------- Step Model ----------
      // step = { a: number[], hi: number[], sorted: {type:'prefix'|'suffix', count:number}, i, j, msg, state }
      function makeStep(a, hi, sorted, i, j, msg, state) {
        return {
          a: a.slice(),
          hi: hi.slice(),
          sorted: { ...sorted },
          i,
          j,
          msg,
          state,
        };
      }

      // ---------- Algorithms to steps ----------
      function stepsInsertion(input) {
        const a = input.slice();
        const steps = [];
        steps.push(
          makeStep(
            a,
            [],
            { type: "prefix", count: 1 },
            "-",
            "-",
            "初始状态：默认把第0个元素看成“有序区”。",
            "准备"
          )
        );

        for (let i = 1; i < a.length; i++) {
          const e = a[i];
          let j = i - 1;

          steps.push(
            makeStep(
              a,
              [i],
              { type: "prefix", count: i },
              i,
              j,
              `第 ${i} 趟：取出 elem[${i}] = ${e}，在左侧有序区 elem[0..${
                i - 1
              }] 从后向前找插入位置。`,
              "取出元素"
            )
          );

          // 向前查找：遇到比 e 大的就后移
          while (j >= 0 && e < a[j]) {
            steps.push(
              makeStep(
                a,
                [j, j + 1],
                { type: "prefix", count: i },
                i,
                j,
                `e=${e} < elem[${j}]=${a[j]}，把 elem[${j}] 后移到 elem[${
                  j + 1
                }]。`,
                "后移"
              )
            );

            a[j + 1] = a[j];

            steps.push(
              makeStep(
                a,
                [j, j + 1],
                { type: "prefix", count: i },
                i,
                j - 1,
                `后移完成：elem[${j + 1}] 现在是 ${a[j + 1]}。继续向前比较。`,
                "后移完成"
              )
            );

            j--;
          }

          // 插入
          a[j + 1] = e;
          steps.push(
            makeStep(
              a,
              [j + 1],
              { type: "prefix", count: i + 1 },
              i,
              j,
              `插入：把 e=${e} 放到 elem[${
                j + 1
              }]。此时有序区扩大到 elem[0..${i}]。`,
              "插入完成"
            )
          );
        }

        steps.push(
          makeStep(
            a,
            [],
            { type: "prefix", count: a.length },
            "-",
            "-",
            "排序完成：整个序列已按关键字有序。",
            "完成"
          )
        );
        return steps;
      }

      function stepsBubble(input) {
        const a = input.slice();
        const steps = [];
        steps.push(
          makeStep(
            a,
            [],
            { type: "suffix", count: 0 },
            "-",
            "-",
            "初始状态：右侧有序区长度为 0（还没有“冒”出最大值）。",
            "准备"
          )
        );

        const n = a.length;
        for (let i = 1; i < n; i++) {
          // 第 i 趟：把当前最大的“冒”到 n-i
          steps.push(
            makeStep(
              a,
              [],
              { type: "suffix", count: i - 1 },
              i,
              "-",
              `第 ${i} 趟：通过不断比较相邻元素，把当前最大值交换到位置 n-${i}。`,
              "开始一趟"
            )
          );

          for (let j = 0; j < n - i; j++) {
            steps.push(
              makeStep(
                a,
                [j, j + 1],
                { type: "suffix", count: i - 1 },
                i,
                j,
                `比较相邻：elem[${j}]=${a[j]} 和 elem[${j + 1}]=${a[j + 1]}`,
                "比较"
              )
            );

            if (a[j] > a[j + 1]) {
              const t = a[j];
              a[j] = a[j + 1];
              a[j + 1] = t;
              steps.push(
                makeStep(
                  a,
                  [j, j + 1],
                  { type: "suffix", count: i - 1 },
                  i,
                  j,
                  `出现逆序，交换 elem[${j}] 与 elem[${j + 1}]。`,
                  "交换"
                )
              );
            } else {
              steps.push(
                makeStep(
                  a,
                  [j, j + 1],
                  { type: "suffix", count: i - 1 },
                  i,
                  j,
                  "不需要交换，继续向右。",
                  "不交换"
                )
              );
            }
          }

          steps.push(
            makeStep(
              a,
              [n - i],
              { type: "suffix", count: i },
              i,
              "-",
              `第 ${i} 趟结束：位置 ${
                n - i
              } 已放好当前最大值，右侧有序区长度变为 ${i}。`,
              "一趟完成"
            )
          );
        }

        steps.push(
          makeStep(
            a,
            [],
            { type: "suffix", count: n },
            "-",
            "-",
            "排序完成：整个序列已按关键字有序。",
            "完成"
          )
        );
        return steps;
      }

      function pseudocode(algo) {
        if (algo === "insertion") {
          return [
            "直接插入排序（课件思想：无序区取1个，插入到有序区）",
            "for i = 1 .. n-1:",
            "    e = elem[i]          // 暂存",
            "    j = i-1",
            "    while j>=0 and e < elem[j]:",
            "        elem[j+1] = elem[j]    // 后移",
            "        j--",
            "    elem[j+1] = e        // 插入",
          ].join("\n");
        }
        return [
          "冒泡排序（课件思想：比较相邻，最大值逐步“冒”到右侧有序区）",
          "for i = 1 .. n-1:",
          "    for j = 0 .. n-i-1:",
          "        if elem[j] > elem[j+1]:",
          "            swap(elem[j], elem[j+1])",
        ].join("\n");
      }

      // ---------- Render ----------
      function render(step) {
        const viz = $("viz");
        viz.innerHTML = "";

        const a = step.a;
        const maxV = Math.max(...a);
        const minV = Math.min(...a);

        // sorted zone
        const sorted = step.sorted; // {type, count}
        const sortedIdx = new Set();
        if (sorted.type === "prefix") {
          for (let k = 0; k < sorted.count; k++) sortedIdx.add(k);
        } else {
          for (let k = a.length - sorted.count; k < a.length; k++)
            sortedIdx.add(k);
        }

        for (let idx = 0; idx < a.length; idx++) {
          const v = a[idx];

          // height map (keep it visible even when values close)
          const h =
            40 + Math.round(((v - minV) / Math.max(1, maxV - minV)) * 260);

          const bar = document.createElement("div");
          bar.className = "bar";
          bar.style.height = h + "px";
          // simple color by index/value (no fixed palette)
          bar.style.background = `linear-gradient(180deg, rgba(180,220,255,0.25), rgba(180,220,255,0.06))`;

          if (step.hi.includes(idx)) bar.classList.add("highlight");
          if (sortedIdx.has(idx)) bar.classList.add("sorted");

          const num = document.createElement("span");
          num.textContent = v;
          bar.appendChild(num);

          // labels for i/j (optional, only show when numeric)
          if (String(step.i) === String(idx)) {
            const tag = document.createElement("div");
            tag.className = "tag";
            tag.textContent = "i";
            bar.appendChild(tag);
          }
          if (String(step.j) === String(idx)) {
            const tag = document.createElement("div");
            tag.className = "tag";
            tag.textContent = "j";
            tag.style.top = "-42px";
            bar.appendChild(tag);
          }

          viz.appendChild(bar);
        }

        $("msg").textContent = step.msg;
        $("iVal").textContent = step.i;
        $("jVal").textContent = step.j;

        const zoneText =
          sorted.type === "prefix"
            ? `左侧有序区长度=${sorted.count}`
            : `右侧有序区长度=${sorted.count}`;
        $("sortedZone").textContent = zoneText;

        $("stepIdx").textContent = String(state.idx);
        $("stepTotal").textContent = String(state.steps.length - 1);
        $("stateText").textContent = step.state;
      }

      // ---------- App State ----------
      const state = {
        base: [],
        steps: [],
        idx: 0,
        timer: null,
        algo: "insertion",
        speed: 260,
      };

      function rebuildSteps() {
        const a = state.base.slice();
        state.steps =
          state.algo === "insertion" ? stepsInsertion(a) : stepsBubble(a);
        state.idx = 0;
        $("code").textContent = pseudocode(state.algo);
        render(state.steps[state.idx]);
      }

      function stop() {
        if (state.timer) {
          clearInterval(state.timer);
          state.timer = null;
          $("play").textContent = "⏵ 播放";
        }
      }

      function play() {
        if (state.timer) return;
        $("play").textContent = "⏸ 暂停";
        state.timer = setInterval(() => {
          if (state.idx >= state.steps.length - 1) {
            stop();
            return;
          }
          state.idx++;
          render(state.steps[state.idx]);
        }, state.speed);
      }

      function setBase(arr) {
        state.base = arr.slice();
        $("arrInput").value = state.base.join(",");
        rebuildSteps();
      }

      // ---------- Events ----------
      $("algo").addEventListener("change", (e) => {
        state.algo = e.target.value;
        rebuildSteps();
        stop();
      });

      $("speed").addEventListener("input", (e) => {
        state.speed = clampInt(e.target.value, 60, 900);
        $("speedText").textContent = state.speed + "ms";
        if (state.timer) {
          stop();
          play();
        } // refresh interval
      });

      $("random").addEventListener("click", () => {
        stop();
        setBase(randomArray(10, 5, 99));
      });

      $("apply").addEventListener("click", () => {
        stop();
        const arr = parseArray($("arrInput").value);
        if (!arr) {
          alert("输入格式不对：请用逗号分隔数字，例如：52,49,80,36,14");
          return;
        }
        setBase(arr);
      });

      $("reset").addEventListener("click", () => {
        stop();
        rebuildSteps();
      });

      $("prev").addEventListener("click", () => {
        stop();
        state.idx = Math.max(0, state.idx - 1);
        render(state.steps[state.idx]);
      });

      $("next").addEventListener("click", () => {
        stop();
        state.idx = Math.min(state.steps.length - 1, state.idx + 1);
        render(state.steps[state.idx]);
      });

      $("play").addEventListener("click", () => {
        if (state.timer) stop();
        else play();
      });

      // ---------- Init ----------
      // 课件举例里出现过：52,49,80,36,14,58,61,23,97,75（可用来演示排序目标）
      setBase([52, 49, 80, 36, 14, 58, 61, 23, 97, 75]);
      $("code").textContent = pseudocode(state.algo);
    </script>
  </body>
</html>
